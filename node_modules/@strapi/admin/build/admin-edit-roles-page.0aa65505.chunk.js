(self.webpackChunk_strapi_admin=self.webpackChunk_strapi_admin||[]).push([[2544],{64499:function(K,L,o){"use strict";o.d(L,{V:function(){return R}});var e=o(45509),C=o(20108);const R=(E={},O={})=>{const{id:P,...A}=E,{get:h}=(0,e.kY)();if(!P&&(O?.enabled===void 0||O?.enabled))throw new Error('"id" is a required argument');const{data:S,error:W,isError:a,isLoading:Z,refetch:m}=(0,C.useQuery)(["roles",P,"permissions",A],async()=>{const{data:{data:M}}=await h(`/admin/roles/${P}/permissions`,{params:A});return M},O);return{permissions:S,error:W,isError:a,isLoading:Z,refetch:m}}},86409:function(K,L,o){"use strict";o.d(L,{F:function(){return O}});var e=o(32735),C=o(45509),R=o(67879),E=o(20108);const O=(P={},A={})=>{const{id:h="",...S}=P,{get:W}=(0,C.kY)(),{locale:a}=(0,R.Z)(),Z=(0,C.Xe)(a,{sensitivity:"base"}),{data:m,error:M,isError:F,isLoading:g,refetch:b}=(0,E.useQuery)(["roles",h,S],async()=>{const{data:X}=await W(`/admin/roles/${h??""}`,{params:S});return X},A);return{roles:e.useMemo(()=>{let X=[];return h&&m?X=[m.data]:Array.isArray(m?.data)&&(X=m.data),[...X].sort((oe,ee)=>Z.compare(oe.name,ee.name))},[m,h,Z]),error:M,isError:F,isLoading:g,refetch:b}}},15570:function(K,L,o){"use strict";o.r(L),o.d(L,{CreatePage:function(){return Re},default:function(){return Se}});var e=o(32735),C=o(27649),R=o(82055),E=o(87933),O=o(41415),P=o(17e3),A=o(72850),h=o(49372),S=o(15335),W=o(5803),a=o(10369),Z=o(33475),m=o(45509),M=o(29439),F=o(14723),g=o(92802),b=o(86834),Y=o.n(b),X=o(67879),oe=o(15062),ee=o(53038),v=o(8471),me=o(64499),Q=o(30305),H=o(1283),te=o(91720),Ce=o(24346),xe=Ce.Ry().shape({name:Ce.Z_().required(m.I0.required),description:Ce.Z_().required(m.I0.required)});const ie=v.ZP.div`
  border: 1px solid ${({theme:G})=>G.colors.primary200};
  background: ${({theme:G})=>G.colors.primary100};
  padding: ${({theme:G})=>`${G.spaces[2]} ${G.spaces[4]}`};
  color: ${({theme:G})=>G.colors.primary600};
  border-radius: ${({theme:G})=>G.borderRadius};
  font-size: ${12/16}rem;
  font-weight: bold;
`,Re=()=>{const G=(0,ee.$B)("/settings/roles/duplicate/:id"),w=(0,m.lm)(),{lockApp:re,unlockApp:z}=(0,m.o1)(),{formatMessage:j}=(0,X.Z)(),[J,he]=(0,e.useState)(!1),{replace:pe}=(0,ee.k6)(),q=(0,e.useRef)(),{trackUsage:ce}=(0,m.rS)(),{post:Ie,put:Be}=(0,m.kY)(),{params:ve}=G??{},{isLoading:Ze,data:Le}=(0,te.d)(ve?.id,{cacheTime:0}),{permissions:ye,isLoading:Me}=(0,me.V)({id:ve?.id},{cacheTime:0,enabled:!!ve?.id}),Fe=Pe=>{re(),he(!0),ve?.id?ce("willDuplicateRole"):ce("willCreateNewRole"),Promise.resolve(Ie("/admin/roles",Pe)).then(async({data:ne})=>{const{permissionsToSend:le}=q.current.getPermissions();return ve?.id?ce("didDuplicateRole"):ce("didCreateNewRole"),ne.data.id&&!Y()(le)&&await Be(`/admin/roles/${ne.data.id}/permissions`,{permissions:le}),ne}).then(ne=>{he(!1),w({type:"success",message:{id:"Settings.roles.created",defaultMessage:"created"}}),pe(`/settings/roles/${ne.data.id}`)}).catch(ne=>{console.error(ne),he(!1),w({type:"warning",message:{id:"notification.error"}})}).finally(()=>{z()})},Ue=`${j({id:"Settings.roles.form.created",defaultMessage:"Created"})} ${(0,F.Z)(new Date,"PPP")}`;return e.createElement(C.o,null,e.createElement(m.SL,{name:"Roles"}),e.createElement(g.J9,{initialValues:{name:"",description:Ue},onSubmit:Fe,validationSchema:xe,validateOnChange:!1},({handleSubmit:Pe,values:ne,errors:le,handleReset:de,handleChange:ue})=>e.createElement(m.l0,{noValidate:!0},e.createElement(e.Fragment,null,e.createElement(R.T,{primaryAction:e.createElement(E.k,{gap:2},e.createElement(O.z,{variant:"secondary",onClick:()=>{de(),q.current.resetForm()},size:"L"},j({id:"app.components.Button.reset",defaultMessage:"Reset"})),e.createElement(O.z,{onClick:Pe,loading:J,size:"L"},j({id:"global.save",defaultMessage:"Save"}))),title:j({id:"Settings.roles.create.title",defaultMessage:"Create a role"}),subtitle:j({id:"Settings.roles.create.description",defaultMessage:"Define the rights given to the role"}),navigationAction:e.createElement(m.rU,{startIcon:e.createElement(M.Z,null),to:"/settings/roles"},j({id:"global.back",defaultMessage:"Back"}))}),e.createElement(P.D,null,e.createElement(E.k,{direction:"column",alignItems:"stretch",gap:6},e.createElement(A.x,{background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0},e.createElement(E.k,{direction:"column",alignItems:"stretch",gap:4},e.createElement(E.k,{justifyContent:"space-between"},e.createElement(A.x,null,e.createElement(A.x,null,e.createElement(h.Z,{fontWeight:"bold"},j({id:"global.details",defaultMessage:"Details"}))),e.createElement(A.x,null,e.createElement(h.Z,{variant:"pi",textColor:"neutral600"},j({id:"Settings.roles.form.description",defaultMessage:"Name and description of the role"})))),e.createElement(ie,null,j({id:"Settings.roles.form.button.users-with-role",defaultMessage:"{number, plural, =0 {# users} one {# user} other {# users}} with this role"},{number:0}))),e.createElement(S.r,{gap:4},e.createElement(W.P,{col:6},e.createElement(a.o,{name:"name",error:le.name&&j({id:le.name}),label:j({id:"global.name",defaultMessage:"Name"}),onChange:ue,required:!0,value:ne.name})),e.createElement(W.P,{col:6},e.createElement(Z.g,{label:j({id:"global.description",defaultMessage:"Description"}),id:"description",error:le.description&&j({id:le.description}),onChange:ue},ne.description))))),!Ze&&!Me?e.createElement(A.x,{shadow:"filterShadow",hasRadius:!0},e.createElement(H.Z,{isFormDisabled:!1,ref:q,permissions:ye,layout:Le})):e.createElement(A.x,{background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0},e.createElement(m.dO,null))))))))};function Se(){const G=(0,oe.v9)(Q._);return e.createElement(m.O4,{permissions:G.settings.roles.create},e.createElement(Re,null))}},1283:function(K,L,o){"use strict";o.d(L,{Z:function(){return ts}});var e=o(32735),C=o(91215),R=o(90980),E=o(3653),O=o(45509),P=o(23973),A=o.n(P),h=o(86834),S=o.n(h),W=o(60216),a=o.n(W),Z=o(67879),m=o(72850),M=o(98978),F=o.n(M),g=o(8471),b=o(87933),Y=o(82884),X=o(15974),oe=o(96441),ee=o(33795),v=o.n(ee),me=o(9086),Q=o.n(me),H=o(79652),te=o(41415),Ce=o(45112);const be=g.ZP.div`
  position: relative;

  ${({hasConditions:t,disabled:n,theme:r})=>t&&`
    &:before {
      content: '';
      position: absolute;
      top: -3px;
      left: -10px;
      width: 6px;
      height: 6px;
      border-radius: ${20/16}rem;;
      background: ${n?r.colors.neutral100:r.colors.primary600};
    }
  `}
`,xe=({onClick:t,className:n,hasConditions:r,variant:s})=>{const{formatMessage:i}=(0,Z.Z)();return e.createElement(be,{hasConditions:r,className:n},e.createElement(te.z,{variant:s,startIcon:e.createElement(Ce.Z,null),onClick:t},i({id:"global.settings",defaultMessage:"Settings"})))};xe.defaultProps={className:null,hasConditions:!1,variant:"tertiary"},xe.propTypes={onClick:a().func.isRequired,className:a().string,hasConditions:a().bool,variant:a().string};var ie=(0,g.ZP)(xe)``,Re=o(85025),Se=o(55225),G=o(31600),w=o(49372),re=o(11406),z=o(26858),j=o(51654),J=o(97889),he=o(81346),pe=o.n(he),q=o(23940),ce=o.n(q),Ie=o(27799);const Be=t=>Object.values(t).map(n=>Object.entries(n).filter(([,r])=>r).map(([r])=>r)).flat(),ve=t=>t.reduce((n,[r,s])=>(n.push({label:ce()(r),children:s.map(i=>({label:i.displayName,value:i.id}))}),n),[]),Ze=(t,n)=>t.map(([,r])=>r).flat().reduce((r,s)=>({[s.id]:n.includes(s.id),...r}),{}),Le=({arrayOfOptionsGroupedByCategory:t,isFormDisabled:n,isGrey:r,label:s,name:i,onChange:l,value:d})=>{const{formatMessage:c}=(0,Z.Z)(),p=u=>{l(i,Ze(t,u))};return e.createElement(b.k,{as:"li",background:r?"neutral100":"neutral0",paddingBottom:3,paddingTop:3},e.createElement(b.k,{paddingLeft:6,style:{width:180}},e.createElement(w.Z,{variant:"sigma",textColor:"neutral600"},c({id:"Settings.permissions.conditions.can",defaultMessage:"Can"}),"\xA0"),e.createElement(w.Z,{variant:"sigma",title:s,textColor:"primary600",ellipsis:!0},c({id:`Settings.roles.form.permissions.${s.toLowerCase()}`,defaultMessage:s})),e.createElement(w.Z,{variant:"sigma",textColor:"neutral600"},"\xA0",c({id:"Settings.permissions.conditions.when",defaultMessage:"When"}))),e.createElement(m.x,{style:{maxWidth:430,width:"100%"}},e.createElement(Ie.Q,{id:i,customizeContent:u=>`${u.length} currently selected`,onChange:p,value:Be(d),options:ve(t),disabled:n})))};Le.propTypes={arrayOfOptionsGroupedByCategory:a().array.isRequired,isFormDisabled:a().bool.isRequired,isGrey:a().bool.isRequired,label:a().string.isRequired,name:a().string.isRequired,value:a().object.isRequired,onChange:a().func.isRequired};var ye=Le;const Me=(t,n)=>t.reduce((r,s)=>(r[s.id]=v()(n,s.id,!1),r),{}),Fe=(t,n)=>t.reduce((r,s)=>{const[i,l]=s,d=Me(l,n);return r[i]=d,r},{});var Pe=(t,n,r)=>t.reduce((s,i)=>{const l=v()(n,[...i.pathToConditionsObject,"conditions"],{}),d=Fe(r,l);return s[i.pathToConditionsObject.join("..")]=d,s},{});const ne=({actions:t,headerBreadCrumbs:n,isFormDisabled:r,onClosed:s,onToggle:i})=>{const{formatMessage:l}=(0,Z.Z)(),{availableConditions:d,modifiedData:c,onChangeConditions:p}=(0,H.$_)(),u=(0,e.useMemo)(()=>Object.entries(pe()(d,"category")),[d]),f=t.filter(({isDisplayed:y,hasSomeActionsSelected:I,hasAllActionsSelected:D})=>y&&(I||D)),x=(0,e.useMemo)(()=>Pe(f,c,u),[f,c,u]),[$,N]=(0,e.useState)(x),k=(y,I)=>{N((0,J.ZP)(D=>{D[y]||(D[y]={}),D[y].default||(D[y].default={}),D[y].default=I}))},T=()=>{const y=Object.entries($).reduce((I,D)=>{const[B,se]=D,U=Object.values(se).reduce((_,V)=>({..._,...V}),{});return I[B]=U,I},{});p(y),i()};return e.createElement(Re.P,{labelledBy:"condition-modal-breadcrumbs",onClose:s},e.createElement(Se.x,null,e.createElement(z.O,{id:"condition-modal-breadcrumbs",label:n.join(", ")},n.map((y,I,D)=>e.createElement(j.$,{isCurrent:I===D.length-1,key:y},ce()(l({id:y,defaultMessage:y})))))),e.createElement(G.f,null,f.length===0&&e.createElement(w.Z,null,l({id:"Settings.permissions.conditions.no-actions",defaultMessage:"You first need to select actions (create, read, update, ...) before defining conditions on them."})),e.createElement("ul",null,f.map(({actionId:y,label:I,pathToConditionsObject:D},B)=>{const se=D.join("..");return e.createElement(ye,{key:y,arrayOfOptionsGroupedByCategory:u,label:I,isFormDisabled:r,isGrey:B%2===0,name:se,onChange:k,value:v()($,se,{})})}))),e.createElement(re.m,{startActions:e.createElement(te.z,{variant:"tertiary",onClick:i},l({id:"app.components.Button.cancel",defaultMessage:"Cancel"})),endActions:e.createElement(te.z,{onClick:T},l({id:"Settings.permissions.conditions.apply",defaultMessage:"Apply"}))}))};ne.propTypes={actions:a().arrayOf(a().shape({actionId:a().string.isRequired,checkboxName:a().string,hasSomeActionsSelected:a().bool.isRequired,hasAllActionsSelected:a().bool,isDisplayed:a().bool.isRequired,label:a().string})).isRequired,headerBreadCrumbs:a().arrayOf(a().string).isRequired,isFormDisabled:a().bool.isRequired,onClosed:a().func.isRequired,onToggle:a().func.isRequired};var le=ne;const de=`${120/16}rem`,ue=`${200/16}rem`,Ae=`${53/16}rem`;var Ne=g.ZP.div`
  width: ${de};
`,rt=(0,g.ZP)(b.k)`
  padding-right: ${({theme:t})=>t.spaces[2]};
  overflow: hidden;
  flex: 1;
  ${({isCollapsable:t})=>t&&"cursor: pointer;"}
`;const Ge=({children:t,isCollapsable:n,isActive:r,isFormDisabled:s,label:i,onChange:l,onClick:d,checkboxName:c,someChecked:p,value:u})=>{const{formatMessage:f}=(0,Z.Z)();return e.createElement(b.k,{alignItems:"center",paddingLeft:6,style:{width:ue,flexShrink:0}},e.createElement(m.x,{paddingRight:2},e.createElement(Y.C,{name:c,"aria-label":f({id:"Settings.permissions.select-all-by-permission",defaultMessage:"Select all {label} permissions"},{label:i}),disabled:s,onValueChange:x=>l({target:{name:c,value:x}}),indeterminate:p,value:u})),e.createElement(rt,{title:i,alignItems:"center",isCollapsable:n,...n&&{onClick:d,"aria-expanded":r,onKeyDown:({key:x})=>(x==="Enter"||x===" ")&&d(),tabIndex:0,role:"button"}},e.createElement(w.Z,{fontWeight:r?"bold":"",textColor:r?"primary600":"neutral800",ellipsis:!0},ce()(i)),t))};Ge.defaultProps={children:null,checkboxName:"",onChange(){},value:!1,someChecked:!1,isCollapsable:!1},Ge.propTypes={checkboxName:a().string,children:a().node,label:a().string.isRequired,isCollapsable:a().bool,isFormDisabled:a().bool.isRequired,onChange:a().func,onClick:a().func.isRequired,someChecked:a().bool,value:a().bool,isActive:a().bool.isRequired};var at=(0,e.memo)(Ge),Nt=o(72091),Wt=o.n(Nt),Vt=o(85973),Te=o.n(Vt);const it=t=>Te()(t)?Wt()(Object.values(t).map(n=>Te()(n)?it(n):n)):[];var je=it,ze=t=>t?Object.keys(t).reduce((n,r)=>(r!=="conditions"&&(n[r]=t[r]),n),{}):null,Oe=t=>{const n=ze(t),r=je(n);if(!r.length)return{hasAllActionsSelected:!1,hasSomeActionsSelected:!1};const s=r.every(l=>l),i=r.some(l=>l)&&!s;return{hasAllActionsSelected:s,hasSomeActionsSelected:i}},Kt=o(16899),We=(0,g.ZP)(Kt.Z)`
  display: none;
  width: ${10/16}rem;
  transform: rotate(${({$isActive:t})=>t?"180":"0"}deg);
  margin-left: ${({theme:t})=>t.spaces[2]};
`,Ve=t=>`
  ${w.Z} {
    color: ${t.colors.primary600};
    font-weight: ${t.fontWeights.bold}
  }
  ${We} {
    display: block;
    path {
      fill: ${t.colors.primary600}
    };
  }
`,Ut=(t,n,r)=>t.map(({actionId:s,isDisplayed:i,applyToProperties:l,label:d})=>{if(!i)return{actionId:s,hasSomeActionsSelected:!1,isDisplayed:i};const c=[...r.split(".."),s],p=S()(l)?[...c,"properties","enabled"]:c,u=p.join(".."),f=v()(n,[...c,"conditions"],null),x=je(f).some(T=>T);if(S()(l)){const T=v()(n,p,!1);return{actionId:s,checkboxName:u,hasAllActionsSelected:T,hasConditions:x,hasSomeActionsSelected:T,isDisplayed:i,isParentCheckbox:!1,label:d,pathToConditionsObject:c}}const $=v()(n,p,null),{hasAllActionsSelected:N,hasSomeActionsSelected:k}=Oe($);return{actionId:s,checkboxName:u,hasAllActionsSelected:N,hasConditions:x,hasSomeActionsSelected:k,isDisplayed:i,isParentCheckbox:!0,label:d,pathToConditionsObject:c}});const Ye=(t,n)=>`
  ${lt} {
    background-color: ${t.colors.primary100};
    color: ${t.colors.primary600};
    border-radius: ${n?"2px 2px 0 0":"2px"};
  }
  ${ct} {
    display: flex;
  }
  ${ie} {
    display: block;
  }
  &:hover {
   ${Ve(t)}
  }

  &:focus-within {
    ${({theme:r,isActive:s})=>Ye(r,s)}
  }
  
`,lt=g.ZP.div`
  flex: 1;
  display: flex;
  align-items: center;
  height: ${Ae};
  background-color: ${({isGrey:t,theme:n})=>t?n.colors.neutral100:n.colors.neutral0};
  border: 1px solid transparent;
`,Ht=g.ZP.div`
  display: inline-flex;
  min-width: 100%;

  ${ie} {
    display: none;
  }
  ${({isActive:t,theme:n})=>t&&Ye(n,t)}
  &:hover {
    ${({theme:t,isActive:n})=>Ye(t,n)}
  }
`,dt=(0,g.ZP)(b.k)`
  width: ${de};
  position: relative;
`,ct=(0,g.ZP)(m.x)`
  display: none;
  svg {
    width: 11px;
  }
  * {
    fill: ${({theme:t})=>t.colors.primary600};
  }
`,ut=g.ZP.span`
  position: absolute;
  top: -6px;
  left: 37px;
  width: 6px;
  height: 6px;
  border-radius: 20px;
  background: ${({theme:t})=>t.colors.primary600};
`,Gt=(0,g.ZP)(m.x)`
  position: absolute;
  right: 9px;
  transform: translateY(10px);
`,mt=({availableActions:t,isActive:n,isGrey:r,isFormDisabled:s,label:i,onClickToggle:l,pathToData:d})=>{const[c,p]=(0,e.useState)(!1),{formatMessage:u}=(0,Z.Z)(),{modifiedData:f,onChangeParentCheckbox:x,onChangeSimpleCheckbox:$}=(0,H.$_)(),N=()=>{p(U=>!U)},k=()=>{p(!1)},T=v()(f,d.split(".."),{}),y=(0,e.useMemo)(()=>Object.keys(T).reduce((U,_)=>(U[_]=Q()(T[_],"conditions"),U),{}),[T]),{hasAllActionsSelected:I,hasSomeActionsSelected:D}=Oe(y),B=(0,e.useMemo)(()=>Ut(t,f,d),[t,f,d]),se=B.some(({hasConditions:U})=>U);return e.createElement(Ht,{isActive:n},e.createElement(lt,{isGrey:r},e.createElement(at,{isCollapsable:!0,isFormDisabled:s,label:i,checkboxName:d,onChange:x,onClick:l,someChecked:D,value:I,isActive:n},e.createElement(ct,{paddingLeft:2},n?e.createElement(X.Z,null):e.createElement(oe.Z,null))),e.createElement(b.k,{style:{flex:1}},B.map(({actionId:U,hasConditions:_,hasAllActionsSelected:V,hasSomeActionsSelected:fe,isDisplayed:ke,isParentCheckbox:ae,checkboxName:Ee,label:Ke})=>ke?ae?e.createElement(dt,{key:U,justifyContent:"center",alignItems:"center"},_&&e.createElement(ut,null),e.createElement(Y.C,{disabled:s,name:Ee,"aria-label":u({id:"Settings.permissions.select-by-permission",defaultMessage:"Select {label} permission"},{label:`${Ke} ${i}`}),onValueChange:$e=>{x({target:{name:Ee,value:$e}})},indeterminate:fe,value:V})):e.createElement(dt,{key:U,justifyContent:"center",alignItems:"center"},_&&e.createElement(ut,null),e.createElement(Y.C,{disabled:s,indeterminate:_,name:Ee,onValueChange:$e=>{$({target:{name:Ee,value:$e}})},value:V})):e.createElement(Ne,{key:U}))),c&&e.createElement(le,{headerBreadCrumbs:[i,"Settings.permissions.conditions.conditions"],actions:B,isFormDisabled:s,onClosed:k,onToggle:N})),e.createElement(Gt,null,e.createElement(ie,{onClick:N,hasConditions:se})))};mt.propTypes={availableActions:a().array.isRequired,isActive:a().bool.isRequired,isGrey:a().bool.isRequired,isFormDisabled:a().bool.isRequired,label:a().string.isRequired,onClickToggle:a().func.isRequired,pathToData:a().string.isRequired};var zt=mt;const Yt=g.ZP.span`
  color: ${({theme:t})=>t.colors.danger700};
  padding-left: ${({theme:t})=>t.spaces[1]}px;
`;var pt=()=>e.createElement(Yt,null,"*"),wt=(t,n)=>t.map(r=>{const s=Array.isArray(r.subjects)&&r.subjects.indexOf(n)!==-1;return{...r,isDisplayed:s}});const Xt=(0,g.ZP)(m.x)`
  transform: translate(-4px, -12px);

  &:before {
    content: '';
    width: ${4/16}rem;
    height: ${12/16}rem;
    background: ${({theme:t})=>t.colors.primary200};
    display: block;
  }
`,Qt=g.ZP.svg`
  position: relative;
  flex-shrink: 0;
  transform: translate(-0.5px, -1px);

  * {
    fill: ${({theme:t,color:n})=>t.colors[n]};
  }
`,we=t=>e.createElement(Xt,null,e.createElement(Qt,{width:"20",height:"23",viewBox:"0 0 20 23",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},e.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M7.02477 14.7513C8.65865 17.0594 11.6046 18.6059 17.5596 18.8856C18.6836 18.9384 19.5976 19.8435 19.5976 20.9688V20.9688C19.5976 22.0941 18.6841 23.0125 17.5599 22.9643C10.9409 22.6805 6.454 20.9387 3.75496 17.1258C0.937988 13.1464 0.486328 7.39309 0.486328 0.593262H4.50974C4.50974 7.54693 5.06394 11.9813 7.02477 14.7513Z",fill:"#D9D8FF"})));we.defaultProps={fill:"primary200"},we.propTypes={fill:a().string};var Jt=(0,e.memo)(we);const gt=(0,g.ZP)(b.k)`
  width: ${de};
  position: relative;
`,qt=(0,g.ZP)(b.k)`
  height: ${Ae};
`,_t=(0,g.ZP)(m.x)`
  padding-left: ${31/16}rem;
`,en=(0,g.ZP)(m.x)`
  border-left: ${({isVisible:t,theme:n})=>t?`4px solid ${n.colors.primary200}`:"4px solid transparent"};
`,tn=(0,g.ZP)(b.k)`
  padding-left: ${({theme:t})=>t.spaces[4]};
  width: ${({level:t})=>145-t*36}px;

  ${({isCollapsable:t,theme:n})=>t&&`
      ${We} {
        display: block;
        color: ${n.colors.neutral100};
      }
      &:hover {
        ${Ve(n)}
      }
  `}
  ${({isActive:t,theme:n})=>t&&Ve(n)};
`,nn=g.ZP.div`
  padding-top: ${({theme:t})=>t.spaces[2]};
  margin-top: ${({theme:t})=>t.spaces[2]};
  width: ${4/16}rem;
  background-color: ${({theme:t})=>t.colors.primary200};
  border-top-left-radius: 2px;
  border-top-right-radius: 2px;
`,Xe=({childrenForm:t,isFormDisabled:n,recursiveLevel:r,pathToDataFromActionRow:s,propertyActions:i,parentName:l,propertyName:d})=>{const{formatMessage:c}=(0,Z.Z)(),{modifiedData:p,onChangeParentCheckbox:u,onChangeSimpleCheckbox:f}=(0,H.$_)(),[x,$]=(0,e.useState)(null),N=T=>{$(y=>y===T?null:T)},k=(0,e.useMemo)(()=>x?t.find(({value:T})=>T===x):null,[x,t]);return e.createElement(_t,null,e.createElement(nn,null),t.map(({label:T,value:y,required:I,children:D},B)=>{const se=B+1<t.length,U=Array.isArray(D),_=x===y;return e.createElement(en,{key:y,isVisible:se},e.createElement(qt,null,e.createElement(Jt,{color:"primary200"}),e.createElement(b.k,{style:{flex:1}},e.createElement(tn,{level:r,isActive:_,isCollapsable:U},e.createElement(rt,{alignItems:"center",isCollapsable:U,...U&&{onClick:()=>N(y),"aria-expanded":_,onKeyDown:({key:V})=>(V==="Enter"||V===" ")&&N(y),tabIndex:0,role:"button"},title:T},e.createElement(w.Z,{ellipsis:!0},ce()(T)),I&&e.createElement(pt,null),e.createElement(We,{$isActive:_}))),e.createElement(b.k,{style:{flex:1}},i.map(({actionId:V,label:fe,isActionRelatedToCurrentProperty:ke})=>{if(!ke)return e.createElement(Ne,{key:V});const ae=[...s.split(".."),V,"properties",d,...l.split(".."),y],Ee=v()(p,ae,!1);if(!D)return e.createElement(gt,{key:fe,justifyContent:"center",alignItems:"center"},e.createElement(Y.C,{disabled:n,name:ae.join(".."),"aria-label":c({id:"Settings.permissions.select-by-permission",defaultMessage:"Select {label} permission"},{label:`${l} ${T} ${fe}`}),onValueChange:De=>{f({target:{name:ae.join(".."),value:De}})},value:Ee}));const{hasAllActionsSelected:Ke,hasSomeActionsSelected:$e}=Oe(Ee);return e.createElement(gt,{key:fe,justifyContent:"center",alignItems:"center"},e.createElement(Y.C,{key:fe,disabled:n,name:ae.join(".."),"aria-label":c({id:"Settings.permissions.select-by-permission",defaultMessage:"Select {label} permission"},{label:`${l} ${T} ${fe}`}),onValueChange:De=>{u({target:{name:ae.join(".."),value:De}})},value:Ke,indeterminate:$e}))})))),k&&_&&e.createElement(m.x,{paddingBottom:2},e.createElement(Xe,{isFormDisabled:n,parentName:`${l}..${y}`,pathToDataFromActionRow:s,propertyActions:i,propertyName:d,recursiveLevel:r+1,childrenForm:k.children})))}))};Xe.propTypes={childrenForm:a().array.isRequired,isFormDisabled:a().bool.isRequired,parentName:a().string.isRequired,pathToDataFromActionRow:a().string.isRequired,propertyActions:a().array.isRequired,propertyName:a().string.isRequired,recursiveLevel:a().number.isRequired};var sn=(0,e.memo)(Xe);const on=t=>t.reduce((r,s)=>(s.isActionRelatedToCurrentProperty&&r.push(s.actionId),r),[]);var rn=(t,n,r,s,i)=>{const d=on(t).reduce((c,p)=>{const u=[...r.split(".."),p,"properties",s,i],f=v()(n,u,!1);return c[p]=f,c},{});return Oe(d)};const ft=(0,g.ZP)(b.k)`
  width: ${de};
  position: relative;
`,an=(0,g.ZP)(b.k)`
  height: ${Ae};
  flex: 1;

  ${({isCollapsable:t,theme:n})=>t&&`
      ${We} {
        display: block;
        color: ${n.colors.neutral100};
      }
      &:hover {
        ${Ve(n)}
      }
  `}
  ${({isActive:t,theme:n})=>t&&Ve(n)};
`,Qe=({childrenForm:t,label:n,isFormDisabled:r,name:s,required:i,pathToData:l,propertyActions:d,propertyName:c,isOdd:p})=>{const{formatMessage:u}=(0,Z.Z)(),[f,x]=(0,e.useState)(null),{modifiedData:$,onChangeCollectionTypeLeftActionRowCheckbox:N,onChangeParentCheckbox:k,onChangeSimpleCheckbox:T}=(0,H.$_)(),y=f===s,I=(0,e.useMemo)(()=>Array.isArray(t)?t:[],[t]),D=I.length>0,B=(0,e.useCallback)(()=>{D&&x(V=>V===s?null:s)},[D,s]),se=({target:{value:V}})=>{N(l,c,s,V)},{hasAllActionsSelected:U,hasSomeActionsSelected:_}=(0,e.useMemo)(()=>rn(d,$,l,c,s),[d,$,l,c,s]);return e.createElement(e.Fragment,null,e.createElement(an,{alignItems:"center",isCollapsable:D,isActive:y,background:p?"neutral100":"neutral0"},e.createElement(b.k,null,e.createElement(at,{onChange:se,onClick:B,isCollapsable:D,isFormDisabled:r,label:n,someChecked:_,value:U,isActive:y},i&&e.createElement(pt,null),e.createElement(We,{$isActive:y})),e.createElement(b.k,null,d.map(({label:V,isActionRelatedToCurrentProperty:fe,actionId:ke})=>{if(!fe)return e.createElement(Ne,{key:V});const ae=[...l.split(".."),ke,"properties",c,s];if(!D){const De=v()($,ae,!1);return e.createElement(ft,{key:ke,justifyContent:"center",alignItems:"center"},e.createElement(Y.C,{disabled:r,name:ae.join(".."),"aria-label":u({id:"Settings.permissions.select-by-permission",defaultMessage:"Select {label} permission"},{label:`${s} ${V}`}),onValueChange:ns=>{T({target:{name:ae.join(".."),value:ns}})},value:De}))}const Ee=v()($,ae,{}),{hasAllActionsSelected:Ke,hasSomeActionsSelected:$e}=Oe(Ee);return e.createElement(ft,{key:V,justifyContent:"center",alignItems:"center"},e.createElement(Y.C,{disabled:r,name:ae.join(".."),onValueChange:De=>{k({target:{name:ae.join(".."),value:De}})},"aria-label":u({id:"Settings.permissions.select-by-permission",defaultMessage:"Select {label} permission"},{label:`${s} ${V}`}),value:Ke,indeterminate:$e}))})))),y&&e.createElement(sn,{childrenForm:I,isFormDisabled:r,parentName:s,pathToDataFromActionRow:l,propertyName:c,propertyActions:d,recursiveLevel:0}))};Qe.defaultProps={childrenForm:[],required:!1},Qe.propTypes={childrenForm:a().array,label:a().string.isRequired,isFormDisabled:a().bool.isRequired,name:a().string.isRequired,pathToData:a().string.isRequired,propertyActions:a().array.isRequired,propertyName:a().string.isRequired,required:a().bool,isOdd:a().bool.isRequired};var ln=(0,e.memo)(Qe);const ht=(0,g.ZP)(b.k)`
  width: ${de};
  flex-shrink: 0;
`,dn=(0,g.ZP)(b.k)`
  width: ${ue};
  height: ${Ae};
  flex-shrink: 0;
`,yt=({headers:t,label:n})=>{const{formatMessage:r}=(0,Z.Z)(),s=r({id:"Settings.roles.form.permission.property-label",defaultMessage:"{label} permissions"},{label:n});return e.createElement(b.k,null,e.createElement(dn,{alignItems:"center",paddingLeft:6},e.createElement(w.Z,{variant:"sigma",textColor:"neutral500"},s)),t.map(i=>i.isActionRelatedToCurrentProperty?e.createElement(ht,{justifyContent:"center",key:i.label},e.createElement(w.Z,{variant:"sigma",textColor:"neutral500"},r({id:`Settings.roles.form.permissions.${i.label.toLowerCase()}`,defaultMessage:i.label}))):e.createElement(ht,{key:i.label})))};yt.propTypes={headers:a().arrayOf(a().shape({label:a().string.isRequired,isActionRelatedToCurrentProperty:a().bool.isRequired})).isRequired,label:a().string.isRequired};var cn=yt,un=(t,n)=>t.map(r=>{const s=Array.isArray(r.applyToProperties)&&r.applyToProperties.indexOf(n)!==-1&&r.isDisplayed;return{label:r.label,actionId:r.actionId,isActionRelatedToCurrentProperty:s}});const mn=g.ZP.div`
  display: inline-flex;
  flex-direction: column;
  min-width: 0;
`,Ct=({availableActions:t,childrenForm:n,isFormDisabled:r,label:s,pathToData:i,propertyName:l})=>{const d=(0,e.useMemo)(()=>un(t,l),[t,l]);return e.createElement(mn,null,e.createElement(cn,{label:s,headers:d}),e.createElement(m.x,null,n.map(({children:c,label:p,value:u,required:f},x)=>e.createElement(ln,{childrenForm:c,key:u,label:p,isFormDisabled:r,name:u,required:f,propertyActions:d,pathToData:i,propertyName:l,isOdd:x%2===0}))))};Ct.propTypes={childrenForm:a().array.isRequired,availableActions:a().array.isRequired,isFormDisabled:a().bool.isRequired,label:a().string.isRequired,pathToData:a().string.isRequired,propertyName:a().string.isRequired};var pn=Ct;const gn=g.ZP.div`
  flex-direction: column;
  display: inline-flex;
  min-width: 100%;
  ${({theme:t,isActive:n})=>n&&`border: 1px solid ${t.colors.primary600};`}
`,vt=({allActions:t,contentTypeName:n,label:r,index:s,isActive:i,isFormDisabled:l,onClickToggleCollapse:d,pathToData:c,properties:p})=>{const u=(0,e.useCallback)(()=>{d(n)},[n,d]),f=(0,e.useMemo)(()=>wt(t,n),[t,n]);return e.createElement(gn,{isActive:i},e.createElement(zt,{availableActions:f,isActive:i,isGrey:s%2===0,isFormDisabled:l,label:r,onClickToggle:u,pathToData:c}),i&&p.map(({label:x,value:$,children:N})=>e.createElement(pn,{availableActions:f,childrenForm:N,isFormDisabled:l,label:x,pathToData:c,propertyName:$,key:$})))};vt.propTypes={allActions:a().array.isRequired,contentTypeName:a().string.isRequired,index:a().number.isRequired,isActive:a().bool.isRequired,isFormDisabled:a().bool.isRequired,label:a().string.isRequired,onClickToggleCollapse:a().func.isRequired,pathToData:a().string.isRequired,properties:a().array.isRequired};var fn=vt;const Je=({actions:t,isFormDisabled:n,pathToData:r,subjects:s})=>{const[i,l]=(0,e.useState)(null),d=c=>{l(i===c?null:c)};return s.map(({uid:c,label:p,properties:u},f)=>e.createElement(fn,{allActions:t,key:c,contentTypeName:c,label:p,isActive:i===c,isFormDisabled:n,index:f,onClickToggleCollapse:d,pathToData:`${r}..${c}`,properties:u}))};Je.defaultProps={actions:[],subjects:[]},Je.propTypes={actions:a().array.isRequired,isFormDisabled:a().bool.isRequired,pathToData:a().string.isRequired,subjects:a().arrayOf(a().shape({uid:a().string.isRequired,label:a().string.isRequired,properties:a().array.isRequired}))};var hn=(0,e.memo)(Je),yn=t=>t.filter(({subjects:n})=>n&&n.length);const Cn=t=>t.map(({actionId:n})=>n),vn=(t,n)=>t.reduce((r,s)=>(Object.keys(n).forEach(i=>{const l=v()(n,[i,s],{}),d={[i]:ze(l)};r[s]?r[s]={...r[s],...d}:r[s]=d}),r),{});var En=(t,n)=>{const r=Cn(t),s=vn(r,n);return Object.keys(s).reduce((l,d)=>(l[d]=Oe(s[d]),l),{})};const bn=(0,g.ZP)(b.k)`
  width: ${de};
  flex-shrink: 0;
`,qe=({actions:t,isFormDisabled:n,kind:r})=>{const{formatMessage:s}=(0,Z.Z)(),{modifiedData:i,onChangeCollectionTypeGlobalActionCheckbox:l}=(0,H.$_)(),d=(0,e.useMemo)(()=>yn(t),[t]),c=(0,e.useMemo)(()=>En(d,i[r]),[i,d,r]);return e.createElement(m.x,{paddingBottom:4,paddingTop:6,style:{paddingLeft:ue}},e.createElement(b.k,{gap:0},d.map(({label:p,actionId:u})=>e.createElement(bn,{direction:"column",alignItems:"center",justifyContent:"center",key:u,gap:3},e.createElement(w.Z,{variant:"sigma",textColor:"neutral500"},s({id:`Settings.roles.form.permissions.${p.toLowerCase()}`,defaultMessage:p})),e.createElement(Y.C,{disabled:n,onValueChange:f=>{l(r,u,f)},name:u,"aria-label":s({id:"Settings.permissions.select-all-by-permission",defaultMessage:"Select all {label} permissions"},{label:s({id:`Settings.roles.form.permissions.${p.toLowerCase()}`,defaultMessage:p})}),value:v()(c,[u,"hasAllActionsSelected"],!1),indeterminate:v()(c,[u,"hasSomeActionsSelected"],!1)})))))};qe.defaultProps={actions:[]},qe.propTypes={actions:a().arrayOf(a().shape({label:a().string.isRequired,actionId:a().string.isRequired,subjects:a().array.isRequired})),isFormDisabled:a().bool.isRequired,kind:a().string.isRequired};var xn=(0,e.memo)(qe);const Rn=(0,g.ZP)(m.x)`
  overflow-x: auto;
`,Et=({isFormDisabled:t,kind:n,layout:{actions:r,subjects:s}})=>{const i=F()([...s],"label");return e.createElement(Rn,{background:"neutral0"},e.createElement(xn,{actions:r,kind:n,isFormDisabled:t}),e.createElement(hn,{actions:r,isFormDisabled:t,pathToData:n,subjects:i}))};Et.propTypes={isFormDisabled:a().bool.isRequired,kind:a().string.isRequired,layout:a().shape({actions:a().array,subjects:a().arrayOf(a().shape({uid:a().string.isRequired,label:a().string.isRequired,properties:a().array.isRequired}))}).isRequired};var bt=(0,e.memo)(Et),Pn=o(76402);const xt=({children:t,value:n})=>e.createElement(Pn.$l.Provider,{value:n},t);xt.propTypes={children:a().node.isRequired,value:a().exact({availableConditions:a().array.isRequired,modifiedData:a().object.isRequired,onChangeCollectionTypeLeftActionRowCheckbox:a().func.isRequired,onChangeConditions:a().func.isRequired,onChangeSimpleCheckbox:a().func.isRequired,onChangeParentCheckbox:a().func.isRequired,onChangeCollectionTypeGlobalActionCheckbox:a().func.isRequired}).isRequired};var An=xt,Tn=o(83828),Sn=o(61762),Mn=o(89966),Rt=o(8284),On=o(15335),$n=o(5803),Dn=(t,n,r)=>t.map(s=>{const i=[...r,s.action,"properties","enabled"],l=v()(n,i,!1),d=v()(n,[...r,s.action,"conditions"],{}),c=je(d).some(p=>p);return{...s,isDisplayed:l,checkboxName:i.join(".."),hasSomeActionsSelected:l,value:l,hasConditions:c,label:s.displayName,actionId:s.action,pathToConditionsObject:[...r,s.action]}}),Ln=t=>{const n=Object.entries(t).reduce((s,i)=>{const[l,{conditions:d}]=i;return s[l]=d,s},{});return je(n).some(s=>s)};const jn=g.ZP.div`
  flex: 1;
  align-self: center;
  border-top: 1px solid ${({theme:t})=>t.colors.neutral150};
`,kn=g.ZP.div`
  position: relative;
  word-break: keep-all;
  ${({hasConditions:t,disabled:n,theme:r})=>t&&`
    &:before {
      content: '';
      position: absolute;
      top: ${-4/16}rem;
      left: ${-8/16}rem;
      width: ${6/16}rem;
      height: ${6/16}rem;
      border-radius: ${20/16}rem;
      background: ${n?r.colors.neutral100:r.colors.primary600};
    }
  `}
`,Pt=({categoryName:t,isFormDisabled:n,subCategoryName:r,actions:s,pathToData:i})=>{const[l,d]=(0,e.useState)(!1),{modifiedData:c,onChangeParentCheckbox:p,onChangeSimpleCheckbox:u}=(0,H.$_)(),{formatMessage:f}=(0,Z.Z)(),x=v()(c,i,{}),$=(0,e.useMemo)(()=>Object.keys(x).reduce((B,se)=>(B[se]=ze(x[se]),B),{}),[x]),{hasAllActionsSelected:N,hasSomeActionsSelected:k}=Oe($),T=()=>{d(B=>!B)},y=()=>{d(!1)},I=Dn(s,c,i),D=Ln(v()(c,[...i],{}));return e.createElement(e.Fragment,null,e.createElement(m.x,null,e.createElement(b.k,{justifyContent:"space-between",alignItems:"center"},e.createElement(m.x,{paddingRight:4},e.createElement(w.Z,{variant:"sigma",textColor:"neutral600"},r)),e.createElement(jn,null),e.createElement(m.x,{paddingLeft:4},e.createElement(Rt.X,{name:i.join(".."),disabled:n,onValueChange:B=>{p({target:{name:i.join(".."),value:B}})},indeterminate:k,value:N},f({id:"app.utils.select-all",defaultMessage:"Select all"})))),e.createElement(b.k,{paddingTop:6,paddingBottom:6},e.createElement(On.r,{gap:2,style:{flex:1}},I.map(({checkboxName:B,value:se,action:U,displayName:_,hasConditions:V})=>e.createElement($n.P,{col:3,key:U},e.createElement(kn,{disabled:n,hasConditions:V},e.createElement(Rt.X,{name:B,disabled:n,onValueChange:fe=>{u({target:{name:B,value:fe}})},value:se},_))))),e.createElement(ie,{hasConditions:D,onClick:T}))),l&&e.createElement(le,{headerBreadCrumbs:[t,r],actions:I,isFormDisabled:n,onClosed:y,onToggle:T}))};Pt.propTypes={actions:a().array.isRequired,categoryName:a().string.isRequired,isFormDisabled:a().bool.isRequired,subCategoryName:a().string.isRequired,pathToData:a().array.isRequired};var In=Pt;const _e=({childrenForm:t,kind:n,name:r,isOpen:s,isFormDisabled:i,isWhite:l,onOpenCategory:d,pathToData:c})=>{const{formatMessage:p}=(0,Z.Z)(),u=()=>{d(r)},f=(0,e.useMemo)(()=>r.split("::").pop(),[r]);return e.createElement(Tn.U,{expanded:s,onToggle:u,id:`accordion-${r}`,variant:l?"primary":"secondary"},e.createElement(Sn.B,{title:ce()(f),description:`${p({id:"Settings.permissions.category"},{category:f})} ${n==="plugins"?"plugin":n}`}),e.createElement(Mn.v,null,e.createElement(m.x,{padding:6},t.map(({actions:x,subCategoryName:$,subCategoryId:N})=>e.createElement(In,{key:$,actions:x,categoryName:f,isFormDisabled:i,subCategoryName:$,pathToData:[...c,N]})))))};_e.defaultProps={},_e.propTypes={childrenForm:a().array.isRequired,isOpen:a().bool.isRequired,isFormDisabled:a().bool.isRequired,isWhite:a().bool.isRequired,kind:a().string.isRequired,name:a().string.isRequired,onOpenCategory:a().func.isRequired,pathToData:a().array.isRequired};var Bn=_e;const At=({isFormDisabled:t,kind:n,layout:r})=>{const[s,i]=(0,e.useState)(null),l=d=>{i(d===s?null:d)};return e.createElement(m.x,{padding:6,background:"neutral0"},r.map(({category:d,categoryId:c,childrenForm:p},u)=>e.createElement(Bn,{key:d,childrenForm:p,kind:n,isFormDisabled:t,isOpen:s===d,isWhite:u%2===1,name:d,onOpenCategory:l,pathToData:[n,c]})))};At.propTypes={isFormDisabled:a().bool.isRequired,kind:a().string.isRequired,layout:a().arrayOf(a().shape({category:a().string.isRequired,categoryId:a().string.isRequired,childrenForm:a().arrayOf(a().shape({actions:a().array.isRequired})).isRequired}).isRequired).isRequired};var Tt=At,Zn=o(86349),Fn=o.n(Zn),Nn=o(3040),ge=o.n(Nn),St=(t,n,r)=>t.find(s=>s.action===n&&s.subject===r);const Mt=(t,n=[])=>t.reduce((r,s)=>(r[s.id]=n.indexOf(s.id)!==-1,r),{}),Ot=({children:t},n,r="")=>t.reduce((s,i)=>{if(i.children)return{...s,[i.value]:Ot(i,n,`${r}${i.value}.`)};const l=n.indexOf(`${r}${i.value}`)!==-1;return s[i.value]=l,s},{}),Wn=(t,n,r)=>t.reduce((s,i)=>{const l=n.properties.find(({value:d})=>d===i);if(l){const d=v()(r,["properties",l.value],[]),c=Ot(l,d);s.properties[i]=c}return s},{properties:{}}),Vn=(t,n)=>n.reduce((r,s)=>{const i=t.find(({uid:l})=>l===s)||null;return i&&(r[s]=i),r},{});var $t=({subjects:t},n,r,s=[])=>n.reduce((i,l)=>{const d=l.subjects,c=Vn(t,d);if(S()(c))return i;const p=Object.keys(c).reduce((u,f)=>{const{actionId:x,applyToProperties:$}=l,T=c[f].properties.map(({value:B})=>B).every(B=>($||[]).indexOf(B)===-1),y=St(s,x,f),I=Mt(r,v()(y,"conditions",[]));if(S()($)||T)return ge()(u,[f,x],{properties:{enabled:y!==void 0},conditions:I}),u;const D=Wn($,c[f],y);return ge()(u,[f,x],{...D,conditions:I}),u},{});return Fn()(i,p)},{});const Kn=(t,n,r)=>t.reduce((s,i)=>{const l=St(r,i.action,null);return s[i.action]={properties:{enabled:l!==void 0},conditions:Mt(n,l?.conditions??[])},s},{}),Un=(t,n,r)=>t.reduce((s,i)=>(s[i.subCategoryId]=Kn(i.actions,n,r),s),{});var Dt=(t,n,r=[])=>t.reduce((s,{categoryId:i,childrenForm:l})=>{const d=Un(l,n,r);return s[i]=d,s},{});const Lt=t=>t.split(" ").join("-");var jt=(t,n)=>Object.entries(pe()(t,n)).map(([r,s])=>({category:r,categoryId:Lt(r),childrenForm:Object.entries(pe()(s,"subCategory")).map(([i,l])=>({subCategoryName:i,subCategoryId:Lt(i),actions:l}))})),Hn=(t,n)=>{const{conditions:r,sections:{collectionTypes:s,singleTypes:i,plugins:l,settings:d}}=t,c={collectionTypes:s,singleTypes:i,plugins:jt(l,"plugin"),settings:jt(d,"category")},p={collectionTypes:$t(s,s.actions||[],r,n),singleTypes:$t(i,i.actions||[],r,n),plugins:Dt(c.plugins,r,n),settings:Dt(c.settings,r,n)};return{initialData:p,modifiedData:p,layouts:c}},Gn=o(99381),et=o.n(Gn);const kt=t=>Object.keys(t).reduce((n,r)=>{const s=t[r];if(Te()(s)&&!A()(s,"conditions"))return{...n,[r]:kt(s)};if(Te()(s)&&A()(s,"conditions")&&!je(Q()(s,"conditions")).some(l=>l)){const l=Object.keys(s.conditions).reduce((d,c)=>(d[c]=!1,d),{});return{...n,[r]:{...s,conditions:l}}}return n[r]=s,n},{});var tt=kt;const It=(t,n,r=!1)=>Object.keys(t).reduce((s,i)=>{const l=t[i];return i==="conditions"&&!r?(s[i]=l,s):Te()(l)?{...s,[i]:It(l,n,i==="fields")}:(s[i]=n,s)},{});var He=It;const zn={initialData:{},modifiedData:{},layouts:{}};var Yn=(t,n)=>(0,J.ZP)(t,r=>{switch(n.type){case"ON_CHANGE_COLLECTION_TYPE_GLOBAL_ACTION_CHECKBOX":{const{collectionTypeKind:s,actionId:i,value:l}=n,d=["modifiedData",s];Object.keys(v()(t,d)).forEach(c=>{const p=v()(t,[...d,c,i],void 0);if(p){let u=He(p,l);if(!l&&u.conditions){const f=He(u.conditions,!1);u={...u,conditions:f}}ge()(r,[...d,c,i],u)}});break}case"ON_CHANGE_COLLECTION_TYPE_ROW_LEFT_CHECKBOX":{const{pathToCollectionType:s,propertyName:i,rowName:l,value:d}=n;let c=et()(t.modifiedData);const p=s.split(".."),u=v()(c,p,{});Object.keys(u).forEach(f=>{if(A()(u[f],`properties.${i}`)){const x=v()(u,[f,"properties",i,l]),$=[...p,f,"properties",i,l];if(!Te()(x))ge()(c,$,d);else{const N=He(x,d);ge()(c,$,N)}}}),d||(c=tt(c)),ge()(r,"modifiedData",c);break}case"ON_CHANGE_CONDITIONS":{Object.entries(n.conditions).forEach(s=>{const[i,l]=s;ge()(r,["modifiedData",...i.split(".."),"conditions"],l)});break}case"ON_CHANGE_SIMPLE_CHECKBOX":{let s=et()(t.modifiedData);ge()(s,[...n.keys.split("..")],n.value),n.value||(s=tt(s)),ge()(r,"modifiedData",s);break}case"ON_CHANGE_TOGGLE_PARENT_CHECKBOX":{const{keys:s,value:i}=n,l=[...s.split("..")];let d=et()(t.modifiedData);const c=v()(d,l,{}),p=He(c,i);ge()(d,l,p),i||(d=tt(d)),ge()(r,["modifiedData"],d);break}case"RESET_FORM":{r.modifiedData=t.initialData;break}case"SET_FORM_AFTER_SUBMIT":{r.initialData=t.modifiedData;break}default:return r}});const nt=t=>Object.entries(t).filter(([,n])=>n).map(([n])=>n),wn=t=>{const[n,{conditions:r}]=t;return{action:n,subject:null,conditions:nt(r),properties:{}}},Xn=t=>Object.values(t).reduce((n,r)=>{const s=Object.entries(r).reduce((i,l)=>{const[,{properties:{enabled:d}}]=l;if(!d)return i;const c=wn(l);return i.push(c),i},[]);return[...n,...s]},[]);var Bt=t=>Object.values(t).reduce((n,r)=>{const s=Xn(r);return[...n,...s]},[]);const Zt=(t,n="")=>Object.entries(t).reduce((r,s)=>{const[i,l]=s;return Te()(l)?[...r,...Zt(l,`${n}${i}.`)]:(l&&!Te()(l)&&r.push(`${n}${i}`),r)},[]),Qn=(t,n,{conditions:r,properties:s})=>Object.entries(s).reduce((i,l)=>{const[d,c]=l;return i.properties[d]=Zt(c),i},{action:t,subject:n,conditions:nt(r),properties:{}}),Jn=(t,n,{conditions:r})=>({action:t,subject:n,properties:{},conditions:nt(r)}),qn=(t,n)=>Object.entries(n).reduce((s,i)=>{const[l,d]=i;if(!je(d).some(u=>u))return s;if(!d?.properties?.enabled){const u=Qn(l,t,d);return[...s,u]}if(!d.properties.enabled)return s;const p=Jn(l,t,d);return s.push(p),s},[]);var Ft=t=>Object.entries(t).reduce((r,s)=>{const[i,l]=s,d=qn(i,l);return[...r,...d]},[]),_n=t=>{const n=Bt(t.plugins),r=Bt(t.settings),s=Ft(t.collectionTypes),i=Ft(t.singleTypes);return[...n,...r,...s,...i]},es=[{labelId:"app.components.LeftMenuLinkContainer.collectionTypes",defaultMessage:"Collection Types",id:"collectionTypes"},{labelId:"app.components.LeftMenuLinkContainer.singleTypes",id:"singleTypes",defaultMessage:"Single Types"},{labelId:"app.components.LeftMenuLinkContainer.plugins",defaultMessage:"Plugins",id:"plugins"},{labelId:"app.components.LeftMenuLinkContainer.settings",defaultMessage:"Settings",id:"settings"}];const st=(0,e.forwardRef)(({layout:t,isFormDisabled:n,permissions:r},s)=>{const[{initialData:i,layouts:l,modifiedData:d},c]=(0,e.useReducer)(Yn,zn,()=>Hn(t,r)),{formatMessage:p}=(0,Z.Z)();(0,e.useImperativeHandle)(s,()=>({getPermissions(){const k=(0,O.e5)(i.collectionTypes,d.collectionTypes),T=(0,O.e5)(i.singleTypes,d.singleTypes),y={...k,...T};let I;return S()(y)?I=!1:I=Object.values(y).some(D=>Object.values(D).some(B=>A()(B,"conditions"))),{permissionsToSend:_n(d),didUpdateConditions:I}},resetForm(){c({type:"RESET_FORM"})},setFormAfterSubmit(){c({type:"SET_FORM_AFTER_SUBMIT"})}}));const u=(k,T,y,I)=>{c({type:"ON_CHANGE_COLLECTION_TYPE_ROW_LEFT_CHECKBOX",pathToCollectionType:k,propertyName:T,rowName:y,value:I})},f=(k,T,y)=>{c({type:"ON_CHANGE_COLLECTION_TYPE_GLOBAL_ACTION_CHECKBOX",collectionTypeKind:k,actionId:T,value:y})},x=k=>{c({type:"ON_CHANGE_CONDITIONS",conditions:k})},$=(0,e.useCallback)(({target:{name:k,value:T}})=>{c({type:"ON_CHANGE_SIMPLE_CHECKBOX",keys:k,value:T})},[]),N=(0,e.useCallback)(({target:{name:k,value:T}})=>{c({type:"ON_CHANGE_TOGGLE_PARENT_CHECKBOX",keys:k,value:T})},[]);return e.createElement(An,{value:{availableConditions:t.conditions,modifiedData:d,onChangeConditions:x,onChangeSimpleCheckbox:$,onChangeParentCheckbox:N,onChangeCollectionTypeLeftActionRowCheckbox:u,onChangeCollectionTypeGlobalActionCheckbox:f}},e.createElement(C.v,{id:"tabs",label:p({id:"Settings.permissions.users.tabs.label",defaultMessage:"Tabs Permissions"})},e.createElement(R.m,null,es.map(k=>e.createElement(R.O,{key:k.id},p({id:k.labelId,defaultMessage:k.defaultMessage})))),e.createElement(E.n,{style:{position:"relative"}},e.createElement(E.x,null,e.createElement(bt,{layout:l.collectionTypes,kind:"collectionTypes",isFormDisabled:n})),e.createElement(E.x,null,e.createElement(bt,{layout:l.singleTypes,kind:"singleTypes",isFormDisabled:n})),e.createElement(E.x,null,e.createElement(Tt,{layout:l.plugins,kind:"plugins",isFormDisabled:n})),e.createElement(E.x,null,e.createElement(Tt,{layout:l.settings,kind:"settings",isFormDisabled:n})))))});st.defaultProps={permissions:[],layout:{conditions:[],sections:{collectionTypes:{},singleTypes:{actions:[]},settings:[],plugins:[]}}},st.propTypes={layout:a().object,isFormDisabled:a().bool.isRequired,permissions:a().array};var ts=(0,e.memo)(st)},87056:function(K,L,o){"use strict";o.r(L),o.d(L,{default:function(){return w}});var e=o(32735),C=o(45509),R=o(15062),E=o(53038),O=o(30305),P=o(27649),A=o(82055),h=o(87933),S=o(41415),W=o(17e3),a=o(72850),Z=o(29439),m=o(92802),M=o(67879),F=o(64499),g=o(86409),b=o(91720),Y=o(1283),X=o(49372),oe=o(15335),ee=o(5803),v=o(10369),me=o(33475),Q=o(60216),H=o.n(Q);const te=({disabled:re,role:z,values:j,errors:J,onChange:he,onBlur:pe})=>{const{formatMessage:q}=(0,M.Z)();return e.createElement(a.x,{background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0},e.createElement(h.k,{direction:"column",alignItems:"stretch",gap:4},e.createElement(h.k,{justifyContent:"space-between"},e.createElement(a.x,null,e.createElement(a.x,null,e.createElement(X.Z,{fontWeight:"bold"},z?z.name:q({id:"global.details",defaultMessage:"Details"}))),e.createElement(a.x,null,e.createElement(X.Z,{textColor:"neutral500",variant:"pi"},z?z.description:q({id:"Settings.roles.form.description",defaultMessage:"Name and description of the role"})))),e.createElement(S.z,{disabled:!0,variant:"secondary"},q({id:"Settings.roles.form.button.users-with-role",defaultMessage:"{number, plural, =0 {# users} one {# user} other {# users}} with this role"},{number:z.usersCount}))),e.createElement(oe.r,{gap:4},e.createElement(ee.P,{col:6},e.createElement(v.o,{disabled:re,name:"name",error:J.name&&q({id:J.name}),label:q({id:"global.name",defaultMessage:"Name"}),onChange:he,onBlur:pe,required:!0,value:j.name||""})),e.createElement(ee.P,{col:6},e.createElement(me.g,{disabled:re,label:q({id:"global.description",defaultMessage:"Description"}),id:"description",error:J.name&&q({id:J.name}),onChange:he,onBlur:pe},j.description||"")))))};te.defaultProps={disabled:!1,role:null,values:{name:"",description:""}},te.propTypes={disabled:H().bool,errors:H().object.isRequired,onBlur:H().func.isRequired,onChange:H().func.isRequired,role:H().object,values:H().object};var Ce=te,be=o(24346),ie=be.Ry().shape({name:be.Z_().required(C.I0.required)}),Se=()=>{const re=(0,C.lm)(),{formatMessage:z}=(0,M.Z)(),{params:{id:j}}=(0,E.$B)("/settings/roles/:id"),{put:J}=(0,C.kY)(),[he,pe]=(0,e.useState)(!1),q=(0,e.useRef)(),{lockApp:ce,unlockApp:Ie}=(0,C.o1)(),{trackUsage:Be}=(0,C.rS)(),{formatAPIError:ve}=(0,C.So)(),{isLoading:Ze,data:Le}=(0,b.d)(j,{cacheTime:0}),{roles:[ye={}],isLoading:Me,refetch:Fe}=(0,g.F)({id:j},{cacheTime:0}),{permissions:Ue,isLoading:Pe}=(0,F.V)({id:j},{cacheTime:0}),ne=async de=>{try{ce(),pe(!0);const{permissionsToSend:ue,didUpdateConditions:Ae}=q.current.getPermissions();await J(`/admin/roles/${j}`,de),ye.code!=="strapi-super-admin"&&(await J(`/admin/roles/${j}/permissions`,{permissions:ue}),Ae&&Be("didUpdateConditions")),q.current.setFormAfterSubmit(),await Fe(),re({type:"success",message:{id:"notification.success.saved"}})}catch(ue){re({type:"warning",message:ve(ue)})}finally{pe(!1),Ie()}},le=!Me&&ye.code==="strapi-super-admin";return e.createElement(P.o,null,e.createElement(C.SL,{name:"Roles"}),e.createElement(m.J9,{enableReinitialize:!0,initialValues:{name:ye.name,description:ye.description},onSubmit:ne,validationSchema:ie,validateOnChange:!1},({handleSubmit:de,values:ue,errors:Ae,handleChange:ot,handleBlur:Ne})=>e.createElement("form",{onSubmit:de},e.createElement(A.T,{primaryAction:e.createElement(h.k,{gap:2},e.createElement(S.z,{disabled:ye.code==="strapi-super-admin",onClick:de,loading:he,size:"L"},z({id:"global.save",defaultMessage:"Save"}))),title:z({id:"Settings.roles.edit.title",defaultMessage:"Edit a role"}),subtitle:z({id:"Settings.roles.create.description",defaultMessage:"Define the rights given to the role"}),navigationAction:e.createElement(C.rU,{startIcon:e.createElement(Z.Z,null),to:"/settings/roles"},z({id:"global.back",defaultMessage:"Back"}))}),e.createElement(W.D,null,e.createElement(h.k,{direction:"column",alignItems:"stretch",gap:6},e.createElement(Ce,{isLoading:Me||Pe,disabled:le,errors:Ae,values:ue,onChange:ot,onBlur:Ne,role:ye}),!Ze&&!Me&&!Pe?e.createElement(a.x,{shadow:"filterShadow",hasRadius:!0},e.createElement(Y.Z,{isFormDisabled:le,permissions:Ue,ref:q,layout:Le})):e.createElement(a.x,{background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0},e.createElement(C.dO,null)))))))},w=()=>{const re=(0,R.v9)(O._),{isLoading:z,allowedActions:{canRead:j,canUpdate:J}}=(0,C.ss)({read:re.settings.roles.read,update:re.settings.roles.update});return z?e.createElement(C.dO,null):!j&&!J?e.createElement(E.l_,{to:"/"}):e.createElement(Se,null)}},91720:function(K,L,o){"use strict";o.d(L,{d:function(){return R}});var e=o(45509),C=o(20108);const R=(E,O={})=>{const{get:P}=(0,e.kY)(),{data:A,error:h,isError:S,isLoading:W}=(0,C.useQuery)(["permissions",E],async()=>{const{data:{data:a}}=await P("/admin/permissions",{params:{role:E}});return a},O);return{data:A,error:h,isError:S,isLoading:W}}},84802:function(K){function L(o,e,C,R){for(var E=-1,O=o==null?0:o.length;++E<O;){var P=o[E];e(R,P,C(P),o)}return R}K.exports=L},62435:function(K,L,o){var e=o(56671);function C(R,E,O,P){return e(R,function(A,h,S){E(P,A,O(A),S)}),P}K.exports=C},85580:function(K,L,o){var e=o(84802),C=o(62435),R=o(88904),E=o(77236);function O(P,A){return function(h,S){var W=E(h)?e:C,a=A?A():{};return W(h,P,R(S,2),a)}}K.exports=O},72091:function(K,L,o){var e=o(40314),C=1/0;function R(E){var O=E==null?0:E.length;return O?e(E,C):[]}K.exports=R},81346:function(K,L,o){var e=o(40999),C=o(85580),R=Object.prototype,E=R.hasOwnProperty,O=C(function(P,A,h){E.call(P,h)?P[h].push(A):e(P,h,[A])});K.exports=O},83828:function(K,L,o){"use strict";o.d(L,{U:function(){return Z},y:function(){return W}});var e=o(74512),C=o(32735),R=o(8471),E=o(91045),O=o(74971),P=o(49372),A=o(87933),h=o(72850);const S=({theme:m,expanded:M,variant:F,disabled:g,error:b})=>b?`1px solid ${m.colors.danger600} !important`:g?`1px solid ${m.colors.neutral150}`:M?`1px solid ${m.colors.primary600}`:F==="primary"?`1px solid ${m.colors.neutral0}`:`1px solid ${m.colors.neutral100}`,W=(0,R.ZP)(P.Z)``,a=(0,R.ZP)(h.x)`
  border: ${S};

  &:hover:not([aria-disabled='true']) {
    border: 1px solid ${({theme:m})=>m.colors.primary600};

    ${W} {
      color: ${({theme:m,expanded:M})=>M?void 0:m.colors.primary700};
    }

    ${P.Z} {
      color: ${({theme:m,expanded:M})=>M?void 0:m.colors.primary600};
    }

    & > ${A.k} {
      background: ${({theme:m})=>m.colors.primary100};
    }

    [data-strapi-dropdown='true'] {
      background: ${({theme:m})=>m.colors.primary200};
    }
  }
`,Z=({children:m,disabled:M=!1,error:F,expanded:g=!1,hasErrorMessage:b=!0,id:Y,onToggle:X,toggle:oe,size:ee="M",variant:v="primary",shadow:me})=>{const Q=(0,O.M)(Y),H=C.useMemo(()=>({expanded:g,onToggle:X,toggle:oe,id:Q,size:ee,variant:v,disabled:M}),[M,g,Q,X,ee,oe,v]);return(0,e.jsxs)(E.S.Provider,{value:H,children:[(0,e.jsx)(a,{"data-strapi-expanded":g,disabled:M,"aria-disabled":M,expanded:g,hasRadius:!0,variant:v,error:F,shadow:me,children:m}),F&&b&&(0,e.jsx)(h.x,{paddingTop:1,children:(0,e.jsx)(P.Z,{variant:"pi",textColor:"danger600",children:F})})]})}},89966:function(K,L,o){"use strict";o.d(L,{v:function(){return E}});var e=o(74512),C=o(91045),R=o(72850);const E=({children:O,...P})=>{const{expanded:A,id:h}=(0,C.A)();if(!A)return null;const S=`accordion-content-${h}`,W=`accordion-label-${h}`,a=`accordion-desc-${h}`;return(0,e.jsx)(R.x,{role:"region",id:S,"aria-labelledby":W,"aria-describedby":a,...P,children:O})}},91045:function(K,L,o){"use strict";o.d(L,{A:function(){return R},S:function(){return C}});var e=o(32735);const C=(0,e.createContext)({disabled:!1,expanded:!1,id:"",size:"M",variant:"primary"}),R=()=>(0,e.useContext)(C)},61762:function(K,L,o){"use strict";o.d(L,{B:function(){return m}});var e=o(74512),C=o(16899),R=o(8471),E=o(83828),O=o(91045);const P=({expanded:M,disabled:F,variant:g})=>{let b="neutral100";return M?b="primary100":F?b="neutral150":g==="primary"&&(b="neutral0"),b};var A=o(7563),h=o(99140),S=o(87933),W=o(49372);const a=(0,R.ZP)(A.A)`
  text-align: left;

  // necessary to make the ellipsis prop work on the title
  > span {
    max-width: 100%;
  }

  svg {
    width: ${14/16}rem;
    height: ${14/16}rem;

    path {
      fill: ${({theme:M,expanded:F})=>F?M.colors.primary600:M.colors.neutral500};
    }
  }
`,Z=(0,R.ZP)(S.k)`
  min-height: ${({theme:M,size:F})=>M.sizes.accordions[F]};
  border-radius: ${({theme:M,expanded:F})=>F?`${M.borderRadius} ${M.borderRadius} 0 0`:M.borderRadius};

  &:hover {
    svg {
      path {
        fill: ${({theme:M})=>M.colors.primary600};
      }
    }
  }
`,m=({title:M,description:F,as:g="span",togglePosition:b="right",action:Y,...X})=>{const{onToggle:oe,toggle:ee,expanded:v,id:me,size:Q,variant:H,disabled:te}=(0,O.A)(),Ce=`accordion-content-${me}`,be=`accordion-label-${me}`,xe=`accordion-desc-${me}`,ie=Q==="M"?6:4,Re=Q==="M"?ie:ie-2,Se=P({expanded:v,disabled:te,variant:H}),G={as:g,fontWeight:Q==="S"?"bold":void 0,id:be,textColor:v?"primary600":"neutral700",ellipsis:!0,variant:Q==="M"?"delta":void 0},w=v?"primary600":"neutral600",re=v?"primary200":"neutral200",z=Q==="M"?`${32/16}rem`:`${24/16}rem`,j=()=>{te||(ee&&!oe?(console.warn('Deprecation warning: Usage of "toggle" prop in Accordion component is deprecated. This is discouraged and will be removed in the next major release. Please use "onToggle" instead'),ee()):oe&&oe())},J=(0,e.jsx)(S.k,{justifyContent:"center",borderRadius:"50%",height:z,width:z,transform:v?"rotate(180deg)":void 0,"data-strapi-dropdown":!0,"aria-hidden":!0,as:"span",background:re,cursor:te?"not-allowed":"pointer",onClick:j,shrink:0,children:(0,e.jsx)(h.J,{as:C.Z,width:Q==="M"?`${11/16}rem`:`${8/16}rem`,color:v?"primary600":"neutral600"})});return(0,e.jsx)(Z,{paddingBottom:Re,paddingLeft:ie,paddingRight:ie,paddingTop:Re,background:Se,expanded:v,size:Q,justifyContent:"space-between",cursor:te?"not-allowed":"",children:(0,e.jsxs)(S.k,{gap:3,flex:1,maxWidth:"100%",children:[b==="left"&&J,(0,e.jsx)(a,{onClick:j,"aria-disabled":te,"aria-expanded":v,"aria-controls":Ce,"aria-labelledby":be,"data-strapi-accordion-toggle":!0,expanded:v,type:"button",flex:1,minWidth:0,...X,children:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(E.y,{...G,children:M}),F&&(0,e.jsx)(W.Z,{as:"p",id:xe,textColor:w,children:F})]})}),b==="right"&&(0,e.jsxs)(S.k,{gap:3,children:[J,Y]}),b==="left"&&Y]})})}},27799:function(K,L,o){"use strict";o.d(L,{Q:function(){return E}});var e=o(74512),C=o(8471),R=o(6407);const E=({options:P,...A})=>(0,e.jsx)(R.NU,{...A,children:P.map(h=>"children"in h?(0,e.jsx)(R.Ab,{label:h.label,values:h.children.map(S=>S.value.toString()),children:h.children.map(S=>(0,e.jsx)(O,{value:S.value,children:S.label},S.value))},h.label):(0,e.jsx)(R.ML,{value:h.value,children:h.label},h.value))}),O=(0,C.ZP)(R.ML)`
  padding-left: ${({theme:P})=>P.spaces[7]};
`}}]);
